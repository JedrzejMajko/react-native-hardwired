{"version":3,"file":"bundler.js","names":["_interopRequireDefault","obj","__esModule","default","getDefaultConfig","mergeConfig","require","_loadMetroConfig","getConfig","config","defaultConfig","projectRoot","Bundler","DeltaBundler","module","exports","globalOptions","mainPath","args","platform","dev","bundleEncoding","sourcemapUseAbsolutePath","resetCache","readGlobalCache","generateStaticViewConfigs","entryFile","bundleOutput","assetsDest","minify","ctx","root","dependencies","healthChecks","platforms","ios","projectConfig","dependencyConfig","android","project","commandConfig","maxWorkers","options","_bundler","_deltaBundler","getWatcher"],"sources":["../../../src/utils/bundler.js"],"sourcesContent":["function _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : { default: obj };\n}\nconst { getDefaultConfig, mergeConfig } = require('metro-config');\n\nconst _loadMetroConfig = _interopRequireDefault(\n  require('@react-native-community/cli-plugin-metro/build/tools/loadMetroConfig')\n);\n\nasync function getConfig(config) {\n  const defaultConfig = await getDefaultConfig(config.projectRoot);\n  return mergeConfig(defaultConfig, config);\n}\n\nconst Bundler = require('metro/src/Bundler');\nconst DeltaBundler = require('metro/src/DeltaBundler');\n\n/**\n * Basic metro setup.\n * @FIXME use metro.config.js to startup\n * @param globalOptions\n * @param mainPath\n * @returns {Promise<{_bundler: Bundler, _deltaBundler: DeltaBundler<MixedOutput>, config: *}>}\n */\nmodule.exports = async function (globalOptions, mainPath) {\n  const args = {\n    platform: globalOptions.platform || 'android',\n    dev: false,\n    bundleEncoding: 'utf8',\n    sourcemapUseAbsolutePath: false,\n    resetCache: true,\n    readGlobalCache: false,\n    generateStaticViewConfigs: true,\n    entryFile: globalOptions.entryFile || 'index.js',\n    bundleOutput: '/dev/null',\n    assetsDest: globalOptions.assetsDest || '/',\n    minify: true,\n  };\n\n  const ctx = {\n    root: mainPath,\n    dependencies: {},\n    healthChecks: [],\n    platforms: {\n      ios: {\n        projectConfig: () => {},\n        dependencyConfig: () => {},\n      },\n      android: {\n        projectConfig: () => {},\n        dependencyConfig: () => {},\n      },\n    },\n    project: () => {},\n  };\n\n  const commandConfig = await (0, _loadMetroConfig.default)(ctx, {\n    maxWorkers: args.maxWorkers,\n    resetCache: args.resetCache,\n    config: args.config,\n  });\n\n  const options = {};\n\n  const config = await getConfig(commandConfig);\n\n  const _bundler = new Bundler(config, options);\n  const _deltaBundler = new DeltaBundler(_bundler.getWatcher());\n\n  return {\n    _bundler,\n    _deltaBundler,\n    config,\n  };\n};\n"],"mappings":"AAAA,SAASA,sBAAsBA,CAACC,GAAG,EAAE;EACnC,OAAOA,GAAG,IAAIA,GAAG,CAACC,UAAU,GAAGD,GAAG,GAAG;IAAEE,OAAO,EAAEF;EAAI,CAAC;AACvD;AACA,MAAM;EAAEG,gBAAgB;EAAEC;AAAY,CAAC,GAAGC,OAAO,CAAC,cAAc,CAAC;AAEjE,MAAMC,gBAAgB,GAAGP,sBAAsB,CAC7CM,OAAO,CAAC,sEAAsE,CAChF,CAAC;AAED,eAAeE,SAASA,CAACC,MAAM,EAAE;EAC/B,MAAMC,aAAa,GAAG,MAAMN,gBAAgB,CAACK,MAAM,CAACE,WAAW,CAAC;EAChE,OAAON,WAAW,CAACK,aAAa,EAAED,MAAM,CAAC;AAC3C;AAEA,MAAMG,OAAO,GAAGN,OAAO,CAAC,mBAAmB,CAAC;AAC5C,MAAMO,YAAY,GAAGP,OAAO,CAAC,wBAAwB,CAAC;;AAEtD;AACA;AACA;AACA;AACA;AACA;AACA;AACAQ,MAAM,CAACC,OAAO,GAAG,gBAAgBC,aAAa,EAAEC,QAAQ,EAAE;EACxD,MAAMC,IAAI,GAAG;IACXC,QAAQ,EAAEH,aAAa,CAACG,QAAQ,IAAI,SAAS;IAC7CC,GAAG,EAAE,KAAK;IACVC,cAAc,EAAE,MAAM;IACtBC,wBAAwB,EAAE,KAAK;IAC/BC,UAAU,EAAE,IAAI;IAChBC,eAAe,EAAE,KAAK;IACtBC,yBAAyB,EAAE,IAAI;IAC/BC,SAAS,EAAEV,aAAa,CAACU,SAAS,IAAI,UAAU;IAChDC,YAAY,EAAE,WAAW;IACzBC,UAAU,EAAEZ,aAAa,CAACY,UAAU,IAAI,GAAG;IAC3CC,MAAM,EAAE;EACV,CAAC;EAED,MAAMC,GAAG,GAAG;IACVC,IAAI,EAAEd,QAAQ;IACde,YAAY,EAAE,CAAC,CAAC;IAChBC,YAAY,EAAE,EAAE;IAChBC,SAAS,EAAE;MACTC,GAAG,EAAE;QACHC,aAAa,EAAEA,CAAA,KAAM,CAAC,CAAC;QACvBC,gBAAgB,EAAEA,CAAA,KAAM,CAAC;MAC3B,CAAC;MACDC,OAAO,EAAE;QACPF,aAAa,EAAEA,CAAA,KAAM,CAAC,CAAC;QACvBC,gBAAgB,EAAEA,CAAA,KAAM,CAAC;MAC3B;IACF,CAAC;IACDE,OAAO,EAAEA,CAAA,KAAM,CAAC;EAClB,CAAC;EAED,MAAMC,aAAa,GAAG,MAAM,CAAC,CAAC,EAAEjC,gBAAgB,CAACJ,OAAO,EAAE2B,GAAG,EAAE;IAC7DW,UAAU,EAAEvB,IAAI,CAACuB,UAAU;IAC3BlB,UAAU,EAAEL,IAAI,CAACK,UAAU;IAC3Bd,MAAM,EAAES,IAAI,CAACT;EACf,CAAC,CAAC;EAEF,MAAMiC,OAAO,GAAG,CAAC,CAAC;EAElB,MAAMjC,MAAM,GAAG,MAAMD,SAAS,CAACgC,aAAa,CAAC;EAE7C,MAAMG,QAAQ,GAAG,IAAI/B,OAAO,CAACH,MAAM,EAAEiC,OAAO,CAAC;EAC7C,MAAME,aAAa,GAAG,IAAI/B,YAAY,CAAC8B,QAAQ,CAACE,UAAU,CAAC,CAAC,CAAC;EAE7D,OAAO;IACLF,QAAQ;IACRC,aAAa;IACbnC;EACF,CAAC;AACH,CAAC"}