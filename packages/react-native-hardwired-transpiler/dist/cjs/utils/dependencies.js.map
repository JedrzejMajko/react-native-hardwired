{"version":3,"file":"dependencies.js","names":["path","require","_require","createModuleIdFactory","findDependencyNames","module","exports","dependencies","entryFile","deps","cliOptions","transformationList","map","dependency","resolve","name","names","push","_typeof","to","length","xpath","relative","mainPath","prefix","substring","factory","hashes","hash","noDependencyNames"],"sources":["../../../src/utils/dependencies.js"],"sourcesContent":["/*\n * Hardwired Copyright (c) 2023 JÄ™drzej Majko (jdrzjm@gmail.com)\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nconst path = require('path');\nconst { createModuleIdFactory } = require('./createModuleIdFactoryNode.js');\n\nconst findDependencyNames = require('./findDependencyNames.js');\n\n/**\n * Build hardwired dependency object based on metro's dependencies\n * @param dependencies\n * @param entryFile\n * @param deps\n * @param cliOptions\n * @returns {*}\n */\nmodule.exports = (dependencies, entryFile, deps, cliOptions) => {\n  let transformationList = {};\n\n  return dependencies.map((dependency) => {\n    const resolve = deps(entryFile, dependency.name);\n\n    let names = [];\n\n    if (typeof transformationList[dependency.name] !== 'undefined') {\n      names.push(transformationList[dependency.name]);\n    }\n\n    if (\n      typeof resolve === 'object' &&\n      resolve !== null &&\n      typeof resolve.to !== 'undefined' &&\n      resolve.to.length > 0\n    ) {\n      const xpath = path.relative(cliOptions.mainPath, resolve.to);\n      if (xpath) {\n        names.push(xpath);\n      }\n    }\n\n    let prefix = '';\n    if (dependency.name.substring(0, 2) != './') {\n      prefix = 'node_modules/';\n    }\n\n    findDependencyNames(prefix + dependency.name, names);\n\n    const factory = createModuleIdFactory();\n\n    let hashes = names.map((name) => {\n      const hash = factory(name);\n      return hash;\n    });\n\n    return cliOptions.noDependencyNames\n      ? { hashes }\n      : {\n          hashes,\n          names,\n        };\n  });\n};\n"],"mappings":";;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,IAAMA,IAAI,GAAGC,OAAO,CAAC,MAAM,CAAC;AAC5B,IAAAC,QAAA,GAAkCD,OAAO,CAAC,gCAAgC,CAAC;EAAnEE,qBAAqB,GAAAD,QAAA,CAArBC,qBAAqB;AAE7B,IAAMC,mBAAmB,GAAGH,OAAO,CAAC,0BAA0B,CAAC;;AAE/D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAI,MAAM,CAACC,OAAO,GAAG,UAACC,YAAY,EAAEC,SAAS,EAAEC,IAAI,EAAEC,UAAU,EAAK;EAC9D,IAAIC,kBAAkB,GAAG,CAAC,CAAC;EAE3B,OAAOJ,YAAY,CAACK,GAAG,CAAC,UAACC,UAAU,EAAK;IACtC,IAAMC,OAAO,GAAGL,IAAI,CAACD,SAAS,EAAEK,UAAU,CAACE,IAAI,CAAC;IAEhD,IAAIC,KAAK,GAAG,EAAE;IAEd,IAAI,OAAOL,kBAAkB,CAACE,UAAU,CAACE,IAAI,CAAC,KAAK,WAAW,EAAE;MAC9DC,KAAK,CAACC,IAAI,CAACN,kBAAkB,CAACE,UAAU,CAACE,IAAI,CAAC,CAAC;IACjD;IAEA,IACEG,OAAA,CAAOJ,OAAO,MAAK,QAAQ,IAC3BA,OAAO,KAAK,IAAI,IAChB,OAAOA,OAAO,CAACK,EAAE,KAAK,WAAW,IACjCL,OAAO,CAACK,EAAE,CAACC,MAAM,GAAG,CAAC,EACrB;MACA,IAAMC,KAAK,GAAGrB,IAAI,CAACsB,QAAQ,CAACZ,UAAU,CAACa,QAAQ,EAAET,OAAO,CAACK,EAAE,CAAC;MAC5D,IAAIE,KAAK,EAAE;QACTL,KAAK,CAACC,IAAI,CAACI,KAAK,CAAC;MACnB;IACF;IAEA,IAAIG,MAAM,GAAG,EAAE;IACf,IAAIX,UAAU,CAACE,IAAI,CAACU,SAAS,CAAC,CAAC,EAAE,CAAC,CAAC,IAAI,IAAI,EAAE;MAC3CD,MAAM,GAAG,eAAe;IAC1B;IAEApB,mBAAmB,CAACoB,MAAM,GAAGX,UAAU,CAACE,IAAI,EAAEC,KAAK,CAAC;IAEpD,IAAMU,OAAO,GAAGvB,qBAAqB,CAAC,CAAC;IAEvC,IAAIwB,MAAM,GAAGX,KAAK,CAACJ,GAAG,CAAC,UAACG,IAAI,EAAK;MAC/B,IAAMa,IAAI,GAAGF,OAAO,CAACX,IAAI,CAAC;MAC1B,OAAOa,IAAI;IACb,CAAC,CAAC;IAEF,OAAOlB,UAAU,CAACmB,iBAAiB,GAC/B;MAAEF,MAAM,EAANA;IAAO,CAAC,GACV;MACEA,MAAM,EAANA,MAAM;MACNX,KAAK,EAALA;IACF,CAAC;EACP,CAAC,CAAC;AACJ,CAAC"}