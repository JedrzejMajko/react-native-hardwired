{"version":3,"file":"errorUtilsContextSwap.js","names":["customErrorUtilMethod","customErrorUtilContainer","oldCallback","error","length","match","arguments","suppressErrorUtils","global","utilsMethod","reportFatalError","reinstateErrorUtils","errorUtilsContextSwap","callback","utilsMethodSuppressed","result","e"],"sources":["../../../src/utils/errorUtilsContextSwap.ts"],"sourcesContent":["/*\n * Copyright (c) 2023 JÄ™drzej Majko (jdrzjm@gmail.com)\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n/**\n * Suppressor allows me to suppress the ErrorUtils.reportFatalError method for blindly loading dependency modules.\n * This is a workaround for the fact that the ErrorUtils.reportFatalError method will throw error regardless of what you do.\n */\n\n/**\n * Custom handler for Fatal Errors for ErrorUtils.reportFatalError\n * Intercepts errors thrown by unknown dependencies during loadDependencies\n * @param error\n */\nexport let customErrorUtilMethod;\nexport const customErrorUtilContainer = (oldCallback) => {\n  return (customErrorUtilMethod = function (error: object): void {\n    if (\n      oldCallback &&\n      typeof oldCallback === \"function\" &&\n      error &&\n      error.length > 0 &&\n      !error[0].match(/Requiring unknown module/)\n    ) {\n      return oldCallback(...arguments);\n    }\n  });\n};\n\n/**\n * Suppress the ErrorUtils.reportFatalError method for blindly loading dependency modules.\n * Use reinstateErrorUtils to roll it back.\n */\nexport const suppressErrorUtils = function (): object | null {\n  if (typeof global[\"ErrorUtils\"] !== \"undefined\") {\n    const utilsMethod = global[\"ErrorUtils\"].reportFatalError;\n    global[\"ErrorUtils\"].reportFatalError =\n      customErrorUtilContainer(utilsMethod);\n    if (utilsMethod !== customErrorUtilMethod) {\n      return utilsMethod;\n    }\n  }\n  return null;\n};\n\n/**\n * Reinstate previous ErrorUtils.reportFatalError method.\n * @param utilsMethod\n */\nexport const reinstateErrorUtils = function (utilsMethod: object | null): void {\n  if (\n    typeof global[\"ErrorUtils\"] !== \"undefined\" &&\n    global[\"ErrorUtils\"].reportFatalError === customErrorUtilMethod\n  ) {\n    global[\"ErrorUtils\"].reportFatalError = utilsMethod;\n  }\n};\n\n/**\n * Callback setup for suppressErrorUtils.\n * It'll initialize the suppressor, run the callback and reinstate original ErrorUtils.\n * @param callback function to run\n */\nexport const errorUtilsContextSwap = async (\n  callback: Function\n): Promise<boolean> => {\n  const utilsMethodSuppressed = suppressErrorUtils();\n\n  let result = false;\n  try {\n    result = await callback();\n  } catch (e) {}\n\n  reinstateErrorUtils(utilsMethodSuppressed);\n\n  return result;\n};\n\nexport default {\n  errorUtilsContextSwap,\n  reinstateErrorUtils,\n  suppressErrorUtils,\n};\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO,IAAIA,qBAAqB;AAChC,OAAO,MAAMC,wBAAwB,GAAIC,WAAW,IAAK;EACvD,OAAQF,qBAAqB,GAAG,SAAAA,CAAUG,KAAa,EAAQ;IAC7D,IACED,WAAW,IACX,OAAOA,WAAW,KAAK,UAAU,IACjCC,KAAK,IACLA,KAAK,CAACC,MAAM,GAAG,CAAC,IAChB,CAACD,KAAK,CAAC,CAAC,CAAC,CAACE,KAAK,CAAC,0BAA0B,CAAC,EAC3C;MACA,OAAOH,WAAW,CAAC,GAAGI,SAAS,CAAC;IAClC;EACF,CAAC;AACH,CAAC;;AAED;AACA;AACA;AACA;AACA,OAAO,MAAMC,kBAAkB,GAAG,SAAAA,CAAA,EAA2B;EAC3D,IAAI,OAAOC,MAAM,CAAC,YAAY,CAAC,KAAK,WAAW,EAAE;IAC/C,MAAMC,WAAW,GAAGD,MAAM,CAAC,YAAY,CAAC,CAACE,gBAAgB;IACzDF,MAAM,CAAC,YAAY,CAAC,CAACE,gBAAgB,GACnCT,wBAAwB,CAACQ,WAAW,CAAC;IACvC,IAAIA,WAAW,KAAKT,qBAAqB,EAAE;MACzC,OAAOS,WAAW;IACpB;EACF;EACA,OAAO,IAAI;AACb,CAAC;;AAED;AACA;AACA;AACA;AACA,OAAO,MAAME,mBAAmB,GAAG,SAAAA,CAAUF,WAA0B,EAAQ;EAC7E,IACE,OAAOD,MAAM,CAAC,YAAY,CAAC,KAAK,WAAW,IAC3CA,MAAM,CAAC,YAAY,CAAC,CAACE,gBAAgB,KAAKV,qBAAqB,EAC/D;IACAQ,MAAM,CAAC,YAAY,CAAC,CAACE,gBAAgB,GAAGD,WAAW;EACrD;AACF,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA,OAAO,MAAMG,qBAAqB,GAAG,MACnCC,QAAkB,IACG;EACrB,MAAMC,qBAAqB,GAAGP,kBAAkB,CAAC,CAAC;EAElD,IAAIQ,MAAM,GAAG,KAAK;EAClB,IAAI;IACFA,MAAM,GAAG,MAAMF,QAAQ,CAAC,CAAC;EAC3B,CAAC,CAAC,OAAOG,CAAC,EAAE,CAAC;EAEbL,mBAAmB,CAACG,qBAAqB,CAAC;EAE1C,OAAOC,MAAM;AACf,CAAC;AAED,eAAe;EACbH,qBAAqB;EACrBD,mBAAmB;EACnBJ;AACF,CAAC"}